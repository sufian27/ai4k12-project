{% extends "base.html" %}

{% block content %}
<!-- Button trigger modal -->
<button type="button" class="btn btn-primary float-right" data-toggle="modal" data-target="#mappingModal">Make your own emoji!</button>


<button type="button" class="btn btn-outline-success" id="all_faces">View all Faces</button>

<!-- Modal -->
<div class="modal fade" id="mappingModal" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true">
  <div class="modal-dialog" role="document">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title">Customize your emoji</h5>
<!--         <button type="button" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button> -->
      </div>
      <div class="modal-body row"><div class="feature-mapped-area col-md-8 col-xs-8 col-sm-8 col-lg-8"></div><div id = "unmapped-area" class="feature-unmapped-area col-md-4 col-xs-4 col-sm-4 col-lg-4" ondragover = "allowDropFeature(event)" ondrop = "dropFeature(event)"></div></div>
      <div class="modal-footer">
        <button type="button" class="btn btn-secondary update-mapping refresh" data-dismiss="modal">Save & Close</button>
        <button type="button" class="btn btn-primary update-mapping">Save changes</button>
      </div>
    </div>
  </div>
</div>

<div id="face_table" class="hidden"></div>
<div class="row" id="single-face">
	<div id="face" class="col-md-2 col-xs-2 col-sm-2 col-lg-2"></div>
	<div style="overflow:scroll; height:400px;" class="col-md-10 col-xs-10 col-sm-10 col-lg-10">
		<table id="data_table"></table>
	</div>
</div>


{% endblock %}

{% block script %}
<script src="{{ url_for('static', filename = 'js/chernoffface.js') }}"></script>
<script src="{{ url_for('static', filename = 'js/mapping_rule.js') }}"></script>
<script>
	function readpara (para) {
		return para;
	}
	var getLocalData = localStorage.getItem('localDataset');
	var json_dataset = JSON.parse(getLocalData);
	var variables = Object.keys(json_dataset[0]);
	var content = "<tr>" + '<td>' + "id" +"</td>";	
	for (i=0; i<variables.length; i++) {
		if (variables[i] != 'id') {
			content += "<td>" + variables[i] + "</td>";
		}
	}
	content += "</tr>";

	for (i=0; i<json_dataset.length; i++) {
		content += "<tr id = '" + i + "' class = 'datapoint pointer-cursor'>";
		content += "<td>" + json_dataset[i]["id"] + "</td>";
        for (j = 0; j < variables.length; j++) {
        	if (variables[j] != "id") {
        		content += '<td>' + json_dataset[i][variables[j]] + "</td>";
        	}
        }
        content += '</tr>';
	}
	document.getElementById("data_table").innerHTML = content;

  //default selection of json_mapping and datapoint_face for chernoff face generation
  getLocalData = localStorage.getItem('mappingRule');
  var json_mapping_temp = JSON.parse(getLocalData);
  var example = readpara( {{ example }} );
  var dataset_face = readpara( {{ dataset_face | safe }});
  var data_id = 0;
  var datapoint_face = dataset_face[data_id];
	d3.select("#face")
		.call(chernoffFace());
	$("#data_table .datapoint").click( function() {
    	// data_id = parseInt($(this).text()) - 1;
    	data_id = parseInt($(this).attr('id'));
    	datapoint_face = dataset_face[data_id];
    	d3.select("#face svg").remove();
    	d3.select("#face")
    		.call(chernoffFace());
    });

</script>
<script src="{{ url_for('static', filename = 'js/view_all_faces.js') }}"></script>
{% endblock %}