{% extends "base.html" %}

{% block content %}
<img src="{{ url_for('static', filename = 'img/example' + example + '/intro.jpg') }}" width="50%">
<form id="user_data">
	<input type="text" id="user_input" name="user_input">
	<button type="submit">Submit</button>
</form>
<div id="test"></div>
<div id="test2"></div>
<a class="btn btn-primary" role="button">Next</a>
{% endblock %}

{% block script %}
<script>
	function readpara (para) {
		return para;
	}
	var json_object = readpara( {{ json_data | tojson | safe }} );
	var json_dataset = JSON.parse(json_object).records;
	var dataset_face = readpara( {{ dataset_face | safe }} );
	var example = readpara( {{ example }} );

	// var full_json_dataset = JSON.parse(dataset);
	// var json_dataset = full_json_dataset.records.slice(0, 210)
	// var json_dataset = full_json_dataset.records;
	console.log(json_dataset.length);
	var variables = Object.keys(json_dataset[0]);
	$(".btn").click( function() {
		$(this).attr("href", "/var?example=" + example);
	});

	const user_data = document.getElementById("user_data");

	user_data.addEventListener("submit", function (e) {
		e.preventDefault();

        var data = {
            val: document.getElementById("user_input").value
        };

        console.log(this.value);
        fetch(`${window.origin}/intro`, {
            method: "POST",
            credentials: "include",
            body: JSON.stringify(data),
            cache: "no-cache",
            headers: new Headers({
                "content-type": "application/json"
            })
        })
        .then(function (response) {
            if (response.status !== 200) {
                console.log(`Looks like there was a problem. Status code: ${response.status}`);
                return;
                }
            response.json().then(function (data) {
            console.log(data);
            });
        })
        .catch(function (error) {
            console.log("Fetch error: " + error);
        });
	});

	//note: what are needed for most pages: json_dataset, dataset_face(in case some original variables are not numeric), json_mapping, example index
</script>
<script src="{{ url_for('static', filename = 'js/mapping_rule.js') }}"></script>
{% endblock %}
